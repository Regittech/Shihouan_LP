# 紫芳庵 お知らせ投稿・表示システム 設計書

**作成日**: 2025年11月19日
**プロジェクト**: 紫芳庵ウェブサイト お知らせ機能実装
**実装方式**: 簡易的実装(JSON + JavaScript)

---

## 1. システム概要

### 1.1 目的
紫芳庵ウェブサイトにお知らせの投稿・管理・表示機能を追加し、管理者が簡単にお知らせを更新できるようにする。

### 1.2 主な機能
- **フロントエンド表示**: TOPページに最新1件、お知らせ一覧に最新5件を表示
- **詳細ページ**: 個別のお知らせ詳細ページを動的生成
- **管理画面**: お知らせの作成・編集・削除・画像アップロード
- **認証機能**: 管理者のみがアクセスできるパスワード認証
- **高度な機能**: 公開/非公開切り替え、予約投稿、下書き保存

### 1.3 技術スタック
- **フロントエンド**: HTML5 + CSS3 + Vanilla JavaScript
- **データ保存**: JSON形式ファイル (`news-data.json`)
- **画像保存**: `/img/news/` ディレクトリ
- **認証**: LocalStorage + セッション管理
- **サーバー**: 静的ファイル配信 + JSONファイル読み書き

---

## 2. 機能要件

### 2.1 フロントエンド表示機能

#### 2.1.1 TOPページ(index.html)
**表示箇所**: 既存の `<div class="news-badge">` セクション

**表示内容**:
```html
<div class="news-badge">
    <span class="news-badge-new">NEW</span>
    <span class="news-badge-date">{公開日}</span>
    <span class="news-badge-text">{タイトル}</span>
</div>
```

**仕様**:
- 最新の**公開済み**お知らせ1件のみ表示
- 予約投稿の場合、公開日時を過ぎたものを表示
- クリックで詳細ページに遷移

#### 2.1.2 お知らせ一覧セクション(index.html)
**表示箇所**: 既存の `<ul class="notice-list">` セクション

**表示内容**:
```html
<ul class="notice-list">
    <li class="notice-item">
        <span class="notice-date">{公開日}</span>
        <span class="notice-text">{タイトル}</span>
    </li>
    <!-- 最大5件まで -->
</ul>
```

**仕様**:
- 最新の**公開済み**お知らせ5件を表示
- 日付降順(新しい順)でソート
- クリックで詳細ページに遷移
- 5件未満の場合は存在する件数のみ表示

#### 2.1.3 お知らせ詳細ページ
**URL形式**: `/news/{slug}.html`
例: `/news/autumn-menu.html`, `/news/new-year-special.html`

**表示内容**:
- タイトル
- 公開日(YYYY年MM月DD日形式)
- 本文(改行・段落対応)
- 画像(複数対応)
- 既存の[news.html](news.html)のデザインを踏襲

**仕様**:
- URLパラメータまたはファイル名から該当お知らせを取得
- 存在しないスラッグの場合は404表示
- **非公開**のお知らせはアクセス不可
- 予約投稿で公開日時前のお知らせはアクセス不可

---

### 2.2 管理画面機能

#### 2.2.1 ログイン画面
**URL**: `/admin/login.html`

**UI要素**:
- パスワード入力フィールド
- ログインボタン
- エラーメッセージ表示エリア

**仕様**:
- 正しいパスワード入力でダッシュボードにリダイレクト
- セッション管理(LocalStorageにトークン保存)
- 不正なパスワードでエラーメッセージ表示

**認証情報**:
- 管理者パスワード: 環境変数または設定ファイルで管理
- 初期パスワード: `shihouan2025` (後で変更可能)

#### 2.2.2 管理ダッシュボード
**URL**: `/admin/dashboard.html`

**UI要素**:
- お知らせ一覧テーブル(タイトル、公開日、ステータス、操作ボタン)
- 新規作成ボタン
- ログアウトボタン
- 各お知らせの編集・削除ボタン

**表示内容**:
| タイトル | 公開日 | ステータス | 操作 |
|---------|--------|-----------|------|
| 秋のメニュー... | 2025/11/01 | 公開中 | 編集 / 削除 |
| 年末年始営業... | 2025/12/20 | 予約投稿 | 編集 / 削除 |
| 新メニュー案 | - | 下書き | 編集 / 削除 |

**ステータス表示**:
- **公開中**: 緑色バッジ
- **非公開**: グレーバッジ
- **予約投稿**: オレンジバッジ(公開日時表示)
- **下書き**: 水色バッジ

**仕様**:
- 未ログイン時はログイン画面にリダイレクト
- 日付降順で全お知らせを表示(下書き含む)
- 削除時は確認ダイアログ表示

#### 2.2.3 お知らせ作成・編集画面
**URL**: `/admin/dashboard.html` 内のモーダルまたは専用フォーム

**入力フォーム**:
1. **タイトル** (必須)
   - テキスト入力
   - 最大100文字

2. **スラッグ** (必須)
   - 英数字・ハイフンのみ
   - 自動生成オプション(タイトルをローマ字変換)
   - 重複チェック

3. **公開日** (必須)
   - 日付ピッカー
   - デフォルト: 今日の日付

4. **本文** (必須)
   - テキストエリア
   - 改行・段落対応
   - 最大5000文字

5. **画像アップロード** (任意)
   - 複数ファイル対応(最大5枚)
   - PNG/JPG形式のみ
   - 各ファイル最大5MB
   - プレビュー表示
   - 削除ボタン

6. **公開設定** (必須)
   - ラジオボタン:
     - 即時公開
     - 予約投稿(日時指定)
     - 下書き保存
     - 非公開

7. **予約投稿日時** (予約投稿選択時のみ)
   - 日時ピッカー
   - 未来の日時のみ選択可能

**ボタン**:
- 保存ボタン
- キャンセルボタン
- プレビューボタン(任意実装)

**バリデーション**:
- 必須項目の入力チェック
- スラッグの形式チェック・重複チェック
- 画像ファイルのサイズ・形式チェック
- 予約投稿日時が未来かチェック

---

## 3. データ構造

### 3.1 JSON形式(news-data.json)

```json
{
  "news": [
    {
      "id": "unique-id-001",
      "title": "秋のメニューをぜひご賞味ください",
      "slug": "autumn-menu-2025",
      "publishDate": "2025-11-01",
      "publishTime": "09:00",
      "body": "本文内容...\n\n段落も対応します。",
      "images": [
        "img/news/autumn-menu-01.png",
        "img/news/autumn-menu-02.png"
      ],
      "status": "published",
      "scheduledDate": null,
      "createdAt": "2025-10-25T14:30:00Z",
      "updatedAt": "2025-10-25T14:30:00Z"
    },
    {
      "id": "unique-id-002",
      "title": "年末年始の営業についてのお知らせ",
      "slug": "new-year-schedule",
      "publishDate": "2025-12-20",
      "publishTime": "10:00",
      "body": "年末年始の営業スケジュールについて...",
      "images": [],
      "status": "scheduled",
      "scheduledDate": "2025-12-20T10:00:00Z",
      "createdAt": "2025-11-15T10:00:00Z",
      "updatedAt": "2025-11-15T10:00:00Z"
    },
    {
      "id": "unique-id-003",
      "title": "新メニュー企画案",
      "slug": "new-menu-draft",
      "publishDate": null,
      "publishTime": null,
      "body": "新しいメニューの企画内容...",
      "images": ["img/news/draft-menu.png"],
      "status": "draft",
      "scheduledDate": null,
      "createdAt": "2025-11-18T16:00:00Z",
      "updatedAt": "2025-11-18T16:00:00Z"
    }
  ],
  "settings": {
    "adminPasswordHash": "hashed-password-here",
    "nextId": 4
  }
}
```

### 3.2 フィールド定義

| フィールド | 型 | 必須 | 説明 |
|----------|-----|------|------|
| id | string | ○ | 一���のID(自動生成) |
| title | string | ○ | お知らせタイトル |
| slug | string | ○ | URL用スラッグ(英数字・ハイフン) |
| publishDate | string | △ | 公開日(YYYY-MM-DD) ※下書き時はnull |
| publishTime | string | △ | 公開時刻(HH:MM) ※下書き時はnull |
| body | string | ○ | 本文(改行コード含む) |
| images | array | × | 画像パスの配列 |
| status | enum | ○ | published / scheduled / draft / unpublished |
| scheduledDate | string | × | 予約投稿日時(ISO 8601形式) |
| createdAt | string | ○ | 作成日時(ISO 8601形式) |
| updatedAt | string | ○ | 更新日時(ISO 8601形式) |

### 3.3 ステータス定義

- **published**: 公開中(即時公開)
- **scheduled**: 予約投稿(scheduledDateに指定日時)
- **draft**: 下書き
- **unpublished**: 非公開(一度公開したが非公開に変更)

---

## 4. ファイル構成

```
/Users/hinotakafumi/Desktop/shihohonn/
├── index.html                     (既存 - 修正)
├── news.html                      (既存 - 参考デザイン)
├── news-detail-template.html      (新規 - 詳細ページテンプレート)
├── style.css                      (既存 - 変更なし)
├── news.css                       (既存 - 変更なし)
├── news-data.json                 (新規 - データファイル)
│
├── admin/
│   ├── login.html                 (新規 - ログイン画面)
│   ├── dashboard.html             (新規 - 管理画面)
│   └── admin.css                  (新規 - 管理画面スタイル)
│
├── js/
│   ├── news-display.js            (新規 - フロント表示用)
│   ├── news-detail.js             (新規 - 詳細ページ用)
│   ├── admin-auth.js              (新規 - 認証管理)
│   └── admin-dashboard.js         (新規 - ダッシュボード機能)
│
└── img/
    └── news/                      (新規 - お知らせ画像保存先)
        ├── (アップロード画像が保存される)
```

---

## 5. 画面遷移図

```
[index.html (TOP)]
    ↓ (お知らせクリック)
[/news/{slug}.html (詳細)]

[/admin/login.html (ログイン)]
    ↓ (認証成功)
[/admin/dashboard.html (管理画面)]
    ↓ (新規作成 / 編集)
[/admin/dashboard.html (フォーム表示)]
    ↓ (保存)
[/admin/dashboard.html (一覧に戻る)]
```

---

## 6. セキュリティ考慮事項

### 6.1 認証
- パスワードはハッシュ化して保存(SHA-256)
- セッショントークンをLocalStorageで管理
- トークン有効期限: 24時間
- ログアウト時にトークン削除

### 6.2 XSS対策
- ユーザー入力値(タイトル・本文)をHTMLエスケープ
- 画像ファイル名をサニタイズ

### 6.3 ファイルアップロード
- 許可する拡張子: .png, .jpg, .jpeg のみ
- ファイルサイズ制限: 5MB/ファイル
- ファイル名をランダム文字列に変換(元のファイル名は使用しない)

### 6.4 アクセス制御
- 管理画面は未ログイン時にリダイレクト
- 非公開・予約投稿・下書きのお知らせは詳細ページでアクセス不可

---

## 7. レスポンシブ対応

### 7.1 フロントエンド
- 既存のレスポンシブデザインを維持
- スマホ表示時もお知らせ表示を最適化

### 7.2 管理画面
- PC専用でも可(スマホ対応は優先度低)
- タブレット横向きでも操作可能なレイアウト

---

## 8. 今後の拡張性

### 8.1 将来的に追加可能な機能
- カテゴリー分類(メニュー、営業情報、イベント等)
- タグ機能
- 検索機能
- ページネーション(お知らせが増えた場合)
- リッチテキストエディタ(太字・リンク等)
- 画像編集機能(トリミング・圧縮)
- アクセス解析(閲覧数カウント)

### 8.2 データベース移行を想定
- JSON形式は将来的にMySQL/PostgreSQLに移行可能
- データ構造はRDBMSのテーブル設計に準拠

---

## 9. 実装の優先順位

### Phase 1: 基本表示機能(最優先)
1. JSONデータ構造の作成
2. フロントエンドでのお知らせ表示(TOP・一覧)
3. 詳細ページの動的生成

### Phase 2: 管理画面基本機能
4. ログイン機能
5. ダッシュボード(一覧表示)
6. 新規作成・編集機能(画像なし)

### Phase 3: 高度な機能
7. 画像アップロード機能
8. 予約投稿機能
9. 下書き・非公開機能
10. 削除機能(確認ダイアログ付き)

---

## 10. テスト項目

### 10.1 表示テスト
- [ ] TOPページに最新1件が表示される
- [ ] お知らせ一覧に最新5件が表示される
- [ ] 詳細ページが正しく表示される
- [ ] 画像が正しく表示される
- [ ] 非公開お知らせは詳細ページでアクセス不可

### 10.2 管理画面テスト
- [ ] ログイン成功/失敗が正しく動作する
- [ ] お知らせの新規作成ができる
- [ ] お知らせの編集ができる
- [ ] お知らせの削除ができる
- [ ] 画像アップロードが動作する
- [ ] 公開/非公開の切り替えが動作する
- [ ] 予約投稿が指定日時に公開される
- [ ] 下書き保存が動作する

### 10.3 セキュリティテスト
- [ ] 未ログイン時に管理画面にアクセスできない
- [ ] XSS攻撃が防げる(HTMLタグ入力時)
- [ ] 不正なファイル形式がアップロードできない

---

## 11. 注意事項

1. **JSONファイルの書き込み権限**
   - レンタルサーバーで `news-data.json` への書き込み権限が必要
   - PHPまたはNode.js等のサーバーサイドプログラムが必要

2. **画像保存先の権限**
   - `/img/news/` ディレクトリへの書き込み権限が必要

3. **初回セットアップ**
   - `news-data.json` の初期ファイル作成
   - 管理者パスワードの設定

4. **バックアップ**
   - 定期的に `news-data.json` をバックアップ
   - 画像ファイルもバックアップ推奨

---

## 12. 参考リンク・資料

- 現在のデザイン: [news.html](http://localhost:8000/news.html)
- GitHubリポジトリ: https://github.com/Regittech/Shihouan_LP.git
- プロジェクトディレクトリ: `/Users/hinotakafumi/Desktop/shihohonn/`

---

**設計書作成者**: Claude Code
**承認者**: プロジェクト管理者
**最終更新日**: 2025年11月19日
